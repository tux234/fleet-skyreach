- name: CIS - Ensure Show All Filename Extensions Setting is Enabled
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM users AS u
      LEFT JOIN (
        SELECT * FROM plist WHERE
          path LIKE '/Users/%/Library/Preferences/.GlobalPreferences.plist' AND
          key = 'AppleShowAllExtensions' AND
          value = '1') AS p
      ON p.path = CONCAT(u.directory, '/Library/Preferences/.GlobalPreferences.plist')
        WHERE u.directory LIKE '/Users/%' AND
        p.value IS NULL
    );
  critical: false
  description: |
    A filename extension is a suffix added to a base filename that indicates the base filename's
    file format. Visible filename extensions allow the user to identify the file type and the
    application it is associated with which leads to quick identification of misrepresented malicious files.
  resolution: |
    Automated method:
    Ask your system administrator to deploy a script that will ensure Show All Filename Extensions Setting is Enabled
        For each user run:
        /usr/bin/sudo -u <username> /usr/bin/defaults write /Users/<username>/Library/Preferences/.GlobalPreferences.plist AppleShowAllExtensions -bool true
  platform: darwin
