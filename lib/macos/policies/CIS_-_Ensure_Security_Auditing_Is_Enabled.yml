- name: CIS - Ensure Security Auditing Is Enabled
  query: |
    SELECT 1 WHERE EXISTS (
      SELECT
        l.program, l.label, l.program_arguments,
        p.path, p.name , p.cmdline
      FROM
        launchd AS l
        INNER JOIN processes AS p
      ON (l.program = p.path)
      WHERE
      (l.label = "com.apple.auditd")
      AND
      (l.program_arguments = p.cmdline)
    );
  critical: false
  description: |
    macOS's audit facility, auditd, receives notifications from the kernel when certain system calls, such as open, fork, and exit, are made. These notifications are captured and written to an audit log. Apple has deprecated auditd as of macOS 11.0 Big Sur. In macOS 14.0 Sonoma it is no longer enabled by default..
  resolution: |
    Automated method:
    Ask your system administrator to deploy the following script which will enable security auditing and create the audit_control file::
    /usr/bin/sudo /bin/launchctl load -w /System/Library/LaunchDaemons/com.apple.auditd.plist
    /usr/bin/sudo /bin/cp /etc/security/audit_control.example /etc/security/audit_control
  platform: darwin
