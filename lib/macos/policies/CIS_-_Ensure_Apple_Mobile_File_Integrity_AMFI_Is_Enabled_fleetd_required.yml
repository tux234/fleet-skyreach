- name: CIS - Ensure Apple Mobile File Integrity (AMFI) Is Enabled (fleetd required)
  query: SELECT 1 FROM nvram_info WHERE amfi_enabled="1";
  critical: false
  description: |
    Apple Mobile File Integrity (AMFI) was first released in macOS 10.12. The daemon and service block attempts to run unsigned code. AMFI uses launchd, code signatures, certificates, entitlements, and provisioning profiles to create a filtered entitlement dictionary for an app. AMFI is the macOS kernel module that enforces code-signing and library validation.
    Note: AMFI cannot be disabled with SIP enabled, but a change attempt can be made that will appear successful, and report incorrectly as successful. If the AMFI audit fails, and the SIP audit passes, this is still an issue the admin should research.
  resolution: |
    Automated method:
      Ask your system administrator to deploy the following script which will Ensure Apple Mobile File Integrity (AMFI) Is Enabled:
      /usr/bin/sudo /usr/sbin/nvram boot-args=""
  platform: darwin
