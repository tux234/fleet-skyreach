- name: CIS - Ensure a Separate Timestamp Is Enabled for Each User/tty (Fleetd Required)
  query: |
    SELECT 1 WHERE EXISTS(
      SELECT
        COALESCE(JSON_EXTRACT(
          json_result, '$.Type of authentication timestamp record'
        ), '') AS type_of_auth_timestamp_record
      FROM sudo_info WHERE type_of_auth_timestamp_record = 'tty'
    );
  critical: false
  description: |
    Using tty tickets ensures that a user must enter the sudo password in each Terminal session.
    With sudo versions 1.8 and higher, introduced in 10.12, the default value is to have tty tickets
    for each interface so that root access is limited to a specific terminal.
    The default configuration can be overwritten or not configured correctly on earlier versions of macOS.
  resolution: |
    Automated method:
    Ask your system administrator to deploy the following script:
    echo 'Defaults timestamp_type=tty' | sudo tee /etc/sudoers.d/CIS_55_sudoconfiguration
  platform: darwin
