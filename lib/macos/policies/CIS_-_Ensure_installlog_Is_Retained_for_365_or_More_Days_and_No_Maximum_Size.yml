- name: CIS - Ensure install.log Is Retained for 365 or More Days and No Maximum Size
  query: |
    SELECT 1 WHERE
    EXISTS ( SELECT line, 
             CAST ( regex_match(line, 'ttl=(\d+)', 1) AS INTEGER ) AS val 
             FROM file_lines 
             WHERE path = '/etc/asl/com.apple.install' 
             AND val >=365 )
    AND
    NOT EXISTS ( SELECT line  
             FROM file_lines 
             WHERE path = '/etc/asl/com.apple.install'  
             AND  line  LIKE "%all_max=%" );
  critical: false
  description: |
    macOS writes information pertaining to system-related events to the file /var/log/install.log and has a configurable retention policy for this file. The default logging setting limits the file size of the logs and the maximum size for all logs. The default allows for an errant application to fill the log files and does not enforce sufficient log retention. The Benchmark recommends a value based on standard use cases. The value should align with local requirements within the organization.
  resolution: |
    Automated method:
      Ask your system administrator to deploy a script which will ensure proper retention for install.log.
    Terminal Method:
      Perform the following to ensure that install logs are retained for at least 365 days:
      Edit the /etc/asl/com.apple.install file and add or modify the ttl value to 365 or greater on the file line. Also, remove the all_max= setting and value from the file line.
  platform: darwin
