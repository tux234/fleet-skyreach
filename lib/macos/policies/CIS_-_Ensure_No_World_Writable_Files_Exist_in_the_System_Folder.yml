- name: CIS - Ensure No World Writable Files Exist in the System Folder
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM find_cmd WHERE
        directory = '/System/Volumes/Data/System'
        AND type = 'd'
        AND perm = '-2'
        AND path NOT LIKE '%Drop Box%'
    );
  critical: false
  description: |
    Software sometimes insists on being installed in the /System/Volumes/Data/System Directory and has inappropriate world-writable permissions. Macs with writable files in System should be investigated forensically. A file with open writable permissions is a sign of at best a rogue application. It could also be a sign of a computer compromise and a persistent presence on the system.
  resolution: |
    Ask your system administrator to deploy a script that will ensure folders are not world-writable in the /System folder. 
    /usr/bin/sudo IFS=$'\n'
    for sysPermissions in $( /usr/bin/find /System/Volumes/Data/System -type d -perm -2 | /usr/bin/grep -vE "Drop Box|locks" ); 
    do
      /bin/chmod -R o-w "$sysPermissions"
    done
  platform: darwin
