- name: CIS - Ensure the Hide IP Address in Safari is Disabled (Based on organization's policy)
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM users AS u
      LEFT JOIN (
        SELECT * FROM plist WHERE
          path LIKE '/Users/%/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist' AND
          key = 'WBSPrivacyProxyAvailabilityTraffic' AND
           ((value >> 2) & 1) = 0) AS p
      ON p.path = CONCAT(u.directory, '/Library/Containers/com.apple.Safari/Data/Library/Preferences/com.apple.Safari.plist')
      WHERE u.directory LIKE '/Users/%' AND
      p.value IS NULL
    );
  critical: false
  description: |
    Public (Routable) IP addresses can be used to track people to their current location, including
    home and business addresses. While a valid IP addess is necessary to load the site the valid
    address does not need to be provided to known trackers and should be hidden.
    However, enabling this setting will proxy web information through a 3rd party service, which may
    not be allowed by your organization's policy.
  resolution: |
    Ask your system administrator to deploy a script that will configure "Hide IP Address in Safari" to Enabled
      $ /usr/bin/sudo -u <username> /usr/bin/defaults write
      /Users/<username>/Library/Containers/com.apple.Safari/Data/Library/Preferences
      /com.apple.Safari WBSPrivacyProxyAvailabilityTraffic -int 130272
  platform: darwin
