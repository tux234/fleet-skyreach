- name: CIS - Ensure Appropriate Permissions Are Enabled for System Wide Applications
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT apps.path FROM apps
      LEFT JOIN file on file.path = apps.path
      WHERE apps.path LIKE '/Applications/%' AND
      -- file.mode's last character are the permissions for 'other',
      -- bitwise && with '0x2' selects the write permission,
      -- which we do not want here.
      CAST(SUBSTRING(file.mode, -1) AS INTEGER) & 0x2 != 0
    );
  critical: false
  description: |
    Applications in the System Applications Directory (/Applications) should be world- executable since that is their reason to be on the system. They should not be world- writable and allow any process or user to alter them for other processes or users to then execute modified versions.
  resolution: |
    Ask your system administrator to deploy a script that will configure all *.app under /Applications folders to have no write permissions for 'others'. 
    $ /usr/bin/sudo IFS=$'\n'
      for apps in $( /usr/bin/find /Applications -iname "*\.app" -type d -perm -2 ); 
      do
        /bin/chmod -R o-w "$apps"
      done
  platform: darwin
